<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finvest Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#0f1220;color:white;min-height:100vh;padding:20px}
.admin-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:#161a2e;border-radius:10px;margin-bottom:20px}
.card{background:#161a2e;padding:20px;border-radius:12px;margin-bottom:20px}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none}
input{background:#1e2235;color:white}
button{font-weight:bold;cursor:pointer}
.add-btn{background:#2ed573}
.cut-btn{background:#ff4757}
.primary-btn{background:#8f7cff}
.notification{position:fixed;top:20px;right:20px;padding:15px;border-radius:8px;display:none;z-index:99}
</style>
</head>

<body>

<div id="notification" class="notification"></div>

<!-- LOGIN -->
<div id="loginBox" class="card">
<h2>Admin Login</h2>
<input id="adminEmail" placeholder="Admin Email">
<input id="adminPass" type="password" placeholder="Password">
<button class="primary-btn" onclick="adminLogin()">Login</button>
</div>

<!-- PANEL -->
<div id="panel" style="display:none">

<div class="admin-header">
<h2>Finvest Admin Panel</h2>
<button class="cut-btn" onclick="logoutAdmin()">Logout</button>
</div>

<div class="card">
<h3>Search User (6-digit User Code)</h3>
<input id="searchUID" maxlength="6" placeholder="Enter 6-digit User Code">
<button class="primary-btn" onclick="searchUserByUID()">Search</button>
</div>

<div id="userDetails" style="display:none">

<div class="card">
<p><b>Email:</b> <span id="foundEmail"></span></p>
<p><b>User Code:</b> <span id="foundUID"></span></p>
<p><b>Firebase UID:</b> <span id="foundUserId"></span></p>
</div>

<div class="card">
<h3>Main Wallet</h3>
<h1>â‚¹ <span id="adminMainBalance">0</span></h1>
<input id="addMainAmount" type="number" placeholder="Add amount">
<button class="add-btn" onclick="updateBalance('add','balance')">Add</button>
<input id="cutMainAmount" type="number" placeholder="Cut amount">
<button class="cut-btn" onclick="updateBalance('cut','balance')">Cut</button>
</div>

<div class="card">
<h3>Profit Wallet</h3>
<h1>â‚¹ <span id="adminProfitBalance">0</span></h1>
<input id="addProfitAmount" type="number" placeholder="Add amount">
<button class="add-btn" onclick="updateBalance('add','profitWallet')">Add</button>
<input id="cutProfitAmount" type="number" placeholder="Cut amount">
<button class="cut-btn" onclick="updateBalance('cut','profitWallet')">Cut</button>
</div>

<div class="card">
<h3>Quick Actions</h3>
<button class="add-btn" onclick="quickAdd('balance',1000)">+â‚¹1000 Main</button>
<button class="add-btn" onclick="quickAdd('profitWallet',500)">+â‚¹500 Profit</button>
<button class="cut-btn" onclick="resetBalances()">Reset Both Wallets</button>
</div>

</div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (same as user app)
firebase.initializeApp({
 apiKey:"AIzaSyDcnh5YSeSxmeqyTpdYTMyR4yl_vDj8M-g",
 authDomain:"taskearnapp-1e669.firebaseapp.com",
 databaseURL:"https://taskearnapp-1e669-default-rtdb.firebaseio.com",
 projectId:"taskearnapp-1e669"
});

const auth = firebase.auth();
const db = firebase.database();

let currentUserId = null;

// ðŸ”” Notification
function show(msg,err=false){
 const n=document.getElementById("notification");
 n.style.background=err?"#ff4757":"#2ed573";
 n.innerText=msg;
 n.style.display="block";
 setTimeout(()=>n.style.display="none",2500);
}

// ðŸ” Admin Login
function adminLogin(){
 const e=adminEmail.value,p=adminPass.value;
 auth.signInWithEmailAndPassword(e,p)
 .catch(err=>show(err.message,true));
}

// ðŸ”„ Auth State
auth.onAuthStateChanged(u=>{
 if(u){
  loginBox.style.display="none";
  panel.style.display="block";
 }else{
  loginBox.style.display="block";
  panel.style.display="none";
 }
});

// ðŸšª Logout
function logoutAdmin(){
 auth.signOut();
}

// ðŸ” Search User by userCode
function searchUserByUID(){
 const code=searchUID.value.trim();
 if(code.length!==6){
  show("Enter valid 6-digit code",true);
  return;
 }

 db.ref("users")
 .orderByChild("userCode")
 .equalTo(code)
 .once("value",s=>{
  if(!s.exists()){
   show("User not found",true);
   return;
  }

  s.forEach(c=>{
   currentUserId=c.key;
   const d=c.val();

   userDetails.style.display="block";
   foundEmail.innerText=d.email||"N/A";
   foundUID.innerText=d.userCode;
   foundUserId.innerText=currentUserId;
   adminMainBalance.innerText=d.balance||0;
   adminProfitBalance.innerText=d.profitWallet||0;
  });
 });
}

// âž•âž– Update Wallet
function updateBalance(action,field){
 if(!currentUserId){
  show("Search user first",true);
  return;
 }

 const amt=Number(
  field==="balance"
   ? (action==="add"?addMainAmount.value:cutMainAmount.value)
   : (action==="add"?addProfitAmount.value:cutProfitAmount.value)
 );

 if(amt<=0){
  show("Invalid amount",true);
  return;
 }

 db.ref("users/"+currentUserId+"/"+field)
 .transaction(b=>{
  b=Number(b)||0;
  if(action==="cut" && b<amt){
   show("Insufficient balance",true);
   return;
  }
  return action==="add"?b+amt:b-amt;
 }).then(()=>{
  show("Wallet updated");
  searchUserByUID();
 });
}

// âš¡ Quick Add
function quickAdd(field,amt){
 if(!currentUserId){
  show("Search user first",true);
  return;
 }
 db.ref("users/"+currentUserId+"/"+field)
 .transaction(b=>(Number(b)||0)+amt)
 .then(()=>{
  show("Amount added");
  searchUserByUID();
 });
}

// â™» Reset
function resetBalances(){
 if(!currentUserId){
  show("Search user first",true);
  return;
 }
 if(confirm("Reset both wallets?")){
  db.ref("users/"+currentUserId).update({
   balance:0,
   profitWallet:0
  }).then(()=>{
   show("Wallets reset");
   searchUserByUID();
  });
 }
}
</script>

</body>
</html>
