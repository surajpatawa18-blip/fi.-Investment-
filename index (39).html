<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finvest App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{margin:0;font-family:Arial;color:white}

/* ===== LOGIN BACKGROUND ===== */
.auth-bg{
  background:
    linear-gradient(rgba(0,0,0,0.2),rgba(0,0,0,0.2)),
    url("login-bg.jpg");
  background-size:cover;
  background-position:center;
  min-height:100vh;
  display:flex;
  align-items:center;
  padding-left:60px;
}
.login-card{width:360px}
.login-card h1{margin-bottom:30px;letter-spacing:2px}
.login-card input{
  width:100%;padding:12px;margin-top:15px;
  background:transparent;border:none;
  border-bottom:2px solid #f4c430;color:white
}
.login-card input::placeholder{color:#ddd}
.login-card button{
  width:100%;padding:14px;margin-top:25px;
  background:#f4c430;color:#0b6b5f;
  border:none;border-radius:10px;font-weight:bold
}
.forgot{text-align:right;font-size:13px;margin-top:8px;cursor:pointer}
.link{text-align:center;margin-top:15px;cursor:pointer}
.error{color:red;text-align:center;margin-top:10px}

/* ===== APP UI ===== */
.screen{display:none;padding:20px;background:#0f1220;min-height:100vh}
.card{background:#161a2e;padding:20px;border-radius:12px;max-width:360px;margin:15px auto}
input,button,select{width:100%;padding:12px;margin-top:10px;border:none;border-radius:8px}
button{background:#8f7cff;color:white}
.balance{font-size:26px;color:#8f7cff;text-align:center}
.nav{
 display:flex;justify-content:space-around;
 background:#161a2e;padding:10px;
 position:fixed;bottom:0;width:100%
}
</style>
</head>

<body>

<!-- AUTH -->
<div id="screen-auth" class="screen auth-bg">
 <div class="login-card">
  <h1 id="authTitle">WELCOME</h1>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <div class="forgot" onclick="forgotPassword()">Forgot Password?</div>
  <button id="authBtn" onclick="submitAuth()">LOGIN</button>
  <div class="link" onclick="toggleAuth()">Don't have an account? Sign up</div>
  <div class="error" id="error"></div>
 </div>
</div>

<!-- DASHBOARD -->
<div id="screen-dashboard" class="screen">
<h3>Dashboard</h3>

<div class="card">
<h4>Main Wallet</h4>
<div class="balance">â‚¹ <span id="mainBalance">0</span></div>
</div>

<div class="card">
<h4>Profit Wallet</h4>
<div class="balance">â‚¹ <span id="profitBalance">0</span></div>
</div>

<h3>Investment Plans (30% / 120 Hours)</h3>

<div class="card">â‚¹1000 â†’ â‚¹1300
<button onclick="investPlan(1000)">Invest</button></div>

<div class="card">â‚¹1500 â†’ â‚¹1950
<button onclick="investPlan(1500)">Invest</button></div>

<div class="card">â‚¹3000 â†’ â‚¹3900
<button onclick="investPlan(3000)">Invest</button></div>

<h3>My Investments</h3>
<div id="myInvestments"></div>
</div>

<!-- DEPOSIT -->
<div id="screen-deposit" class="screen">
<h3>Deposit</h3>
<div class="card">
<p><b>UPI:</b> 9125422244@ybl</p>
<select id="dAmount">
<option value="">Select Amount</option>
<option value="1000">â‚¹1000</option>
<option value="1500">â‚¹1500</option>
<option value="3000">â‚¹3000</option>
</select>
<input id="utr" placeholder="UTR Number">
<button onclick="submitDeposit()">Submit</button>
</div>
</div>

<!-- WITHDRAW -->
<div id="screen-withdraw" class="screen">
<h3>Withdraw (Profit Only)</h3>
<select id="wAmount">
<option value="">Select Amount</option>
<option value="300">â‚¹300</option>
<option value="450">â‚¹450</option>
<option value="900">â‚¹900</option>
</select>
<input id="wUpi" placeholder="UPI ID">
<button onclick="submitWithdraw()">Withdraw</button>
<p style="font-size:12px;color:#aaa;text-align:center">
Only Sunday | 10AM â€“ 4PM
</p>
</div>

<!-- SUPPORT -->
<div id="screen-support" class="screen">
<div class="card" style="text-align:center">
<h3>Customer Support</h3>
<p>ðŸ“ž 9277169628</p>
<button onclick="openWhatsApp()">Chat on WhatsApp</button>
</div>
</div>

<!-- NAV -->
<div class="nav" id="nav" style="display:none">
<button onclick="show('dashboard')">Home</button>
<button onclick="show('deposit')">Deposit</button>
<button onclick="show('withdraw')">Withdraw</button>
<button onclick="show('support')">Support</button>
<button onclick="logout()">Logout</button>
</div>

<script>
// FIREBASE CONFIG
firebase.initializeApp({
 apiKey:"AIzaSyDcnh5YSeSxmeqyTpdYTMyR4yl_vDj8M-g",
 authDomain:"taskearnapp-1e669.firebaseapp.com",
 databaseURL:"https://taskearnapp-1e669-default-rtdb.firebaseio.com",
 projectId:"taskearnapp-1e669"
});

const auth=firebase.auth();
const db=firebase.database();
const DURATION=120*60*60*1000;
let isLogin=true,timers={};

function hideAll(){document.querySelectorAll(".screen").forEach(s=>s.style.display="none")}
function show(n){hideAll();document.getElementById("screen-"+n).style.display="block"}

function toggleAuth(){
 isLogin=!isLogin;
 authTitle.innerText=isLogin?"WELCOME":"CREATE ACCOUNT";
 authBtn.innerText=isLogin?"LOGIN":"SIGN UP";
}

function submitAuth(){
 error.innerText="";
 if(isLogin){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>error.innerText=e.message);
 }else{
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(r=>db.ref("users/"+r.user.uid)
   .set({balance:0,profitWallet:0}))
  .catch(e=>error.innerText=e.message);
 }
}

function forgotPassword(){
 if(!email.value) return alert("Enter email");
 auth.sendPasswordResetEmail(email.value)
 .then(()=>alert("Reset link sent"))
 .catch(e=>alert(e.message));
}

auth.onAuthStateChanged(u=>{
 hideAll();nav.style.display="none";
 if(!u){show("auth");return;}
 nav.style.display="flex";show("dashboard");

 db.ref("users/"+u.uid+"/balance")
 .on("value",s=>mainBalance.innerText=s.val()||0);
 db.ref("users/"+u.uid+"/profitWallet")
 .on("value",s=>profitBalance.innerText=s.val()||0);

 loadMyInvestments();
});

function logout(){auth.signOut()}

// INVEST
function investPlan(amount){
 const u=auth.currentUser;
 db.ref("users/"+u.uid+"/investments")
 .orderByChild("status").equalTo("running")
 .once("value",snap=>{
  if(snap.exists()) return alert("Only one active investment allowed");

  db.ref("users/"+u.uid+"/balance").transaction(b=>{
   if((b||0)<amount) return alert("Insufficient balance");
   return b-amount;
  },(e,ok)=>{
   if(ok){
    const profit=Math.round(amount*0.30);
    db.ref("users/"+u.uid+"/investments").push({
     investAmount:amount,profit:profit,
     investTime:Date.now(),
     status:"running",credited:false
    });
   }
  });
 });
}

function loadMyInvestments(){
 const u=auth.currentUser;
 myInvestments.innerHTML="";
 db.ref("users/"+u.uid+"/investments").on("value",snap=>{
  myInvestments.innerHTML="";
  snap.forEach(c=>{
   const v=c.val(),id=c.key,end=v.investTime+DURATION;
   if(Date.now()>=end&&!v.credited){
    db.ref("users/"+u.uid+"/balance")
    .transaction(b=>(b||0)+v.investAmount);
    db.ref("users/"+u.uid+"/profitWallet")
    .transaction(p=>(p||0)+v.profit);
    db.ref("users/"+u.uid+"/investments/"+id)
    .update({status:"completed",credited:true});
   }
   myInvestments.innerHTML+=`
   <div class="card">
   Invest â‚¹${v.investAmount}<br>
   Profit â‚¹${v.profit}<br>
   Status ${v.status}<br>
   <span id="t${id}"></span>
   </div>`;
   startTimer(id,end);
  });
 });
}

function startTimer(id,end){
 if(timers[id])return;
 timers[id]=setInterval(()=>{
  const el=document.getElementById("t"+id);
  if(!el)return;
  const d=end-Date.now();
  if(d<=0){el.innerText="Completed";clearInterval(timers[id]);return;}
  el.innerText=Math.floor(d/3600000)+"h "+
  Math.floor(d%3600000/60000)+"m "+
  Math.floor(d%60000/1000)+"s";
 },1000);
}

// DEPOSIT
function submitDeposit(){
 if(!dAmount.value||!utr.value) return alert("Fill all fields");
 db.ref("deposits").push({
  uid:auth.currentUser.uid,
  amount:+dAmount.value,
  utr:utr.value,
  status:"pending",time:Date.now()
 });
 alert("Deposit submitted");
 show("dashboard");
}

// WITHDRAW
function submitWithdraw(){
 const u=auth.currentUser;
 const now=new Date();
 if(now.getDay()!=0) return alert("Sunday only");
 if(now.getHours()<10||now.getHours()>=16) return alert("10AMâ€“4PM only");

 const amt=+wAmount.value,upi=wUpi.value;
 if(!amt||!upi) return alert("Fill all fields");

 const key=now.toDateString();
 const ref=db.ref("users/"+u.uid);

 ref.once("value",s=>{
  if(s.val()?.lastWithdrawSunday===key)
   return alert("Already withdrawn this Sunday");

  ref.child("profitWallet").transaction(p=>{
   if((p||0)<amt) return alert("Insufficient profit");
   return p-amt;
  },(e,ok)=>{
   if(ok){
    ref.update({lastWithdrawSunday:key});
    db.ref("withdrawals").push({
     uid:u.uid,amount:amt,upi:upi,time:Date.now()
    });
    alert("Withdrawal submitted");
    show("dashboard");
   }
  });
 });
}

function openWhatsApp(){
 window.open("https://wa.me/919277169628","_blank");
}
</script>
</body>
</html>
